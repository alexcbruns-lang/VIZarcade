<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Connecting...</title>
  <style>
    body {
      background: #000008;
      color: #06ffd8;
      font-family: 'Courier New', monospace;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      font-size: 1.2rem;
      letter-spacing: 0.2em;
    }
  </style>
</head>
<body>
  <div>CONNECTING TO SPOTIFY...</div>
  <script>
    // Spotify returns token in the hash: /callback#access_token=...
    const hash = window.location.hash.substring(1);
    if (hash) {
      const params = new URLSearchParams(hash);
      const token = params.get('access_token');
      const expiresIn = params.get('expires_in');
      if (token) {
        localStorage.setItem('sp_token', token);
        localStorage.setItem('sp_token_ts', Date.now());
        // Redirect to root without the hash
        window.location.replace('/');
      } else {
        document.body.innerHTML = '<div style="color:#ff006e;font-family:monospace;padding:2rem;">AUTH ERROR: No token in response. <a href="/" style="color:#06ffd8">Try again</a></div>';
      }
    } else {
      // No hash â€” Spotify might have returned an error
      const params = new URLSearchParams(window.location.search);
      const error = params.get('error');
      if (error) {
        document.body.innerHTML = '<div style="color:#ff006e;font-family:monospace;padding:2rem;">SPOTIFY ERROR: ' + error + '. <a href="/" style="color:#06ffd8">Try again</a></div>';
      } else {
        window.location.replace('/');
      }
    }
  </script>
</body>
</html>
